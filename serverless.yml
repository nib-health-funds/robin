service: robin

frameworkVersion: ">=2.0.0 <3.0.0"

provider:
  name: aws
  runtime: nodejs18.x
  stage: "${env:STAGE}"
  region: ap-southeast-2
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "ecr:*"
      Resource: "*"
  environment:
    REPO_NAMES: ${env:REPO_NAMES}
    AWS_ACCOUNT_ID: ${env:AWS_ACCOUNT_ID}
    DRY_RUN: ${env:DRY_RUN, 'true'}
    ECR_REGION: ${env:ECR_REGION, 'us-east-1'}
    SLACK_WEBHOOK: ${env:SLACK_WEBHOOK}

functions:
  cleanupImages:
    handler: handler.cleanupImages
    timeout: 45
    events:
      - schedule: rate(1 day)
