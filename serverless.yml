service: robin

frameworkVersion: ">=2.0.0 <3.0.0"

provider:
  name: aws
  runtime: nodejs18.x
  stage: "${env:SLICE}"
  region: "${env:RQP_REGION}"
  stackTags:
    Name: "${env:APPLICATION}-${env:SLICE}"
    Application: "${env:APPLICATION}"
    LineOfBusiness: "${env:LINE_OF_BUSINESS}"
    Stage: "${env:STAGE}"
    Slice: "${env:SLICE}"
    Zone: "${env:ZONE}"
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "ecr:*"
      Resource: "*"

functions:
  cleanupImages:
    handler: handler.cleanupImages
    environment:
      REPO_NAMES: ${env:REPO_NAMES}
      AWS_ACCOUNT_ID: ${env:AWS_ACCOUNT_ID}
      DRY_RUN: ${env:DRY_RUN, 'true'}
      ECR_REGION: ${env:RQP_REGION, 'us-east-1'}
      SLACK_WEBHOOK: ${env:SLACK_WEBHOOK}
    timeout: 45
    events:
      - schedule: rate(1 day)
